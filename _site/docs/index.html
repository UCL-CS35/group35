<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Docs</title>
  <meta name="description" content="The objective of this project is to build a social data repository for the Internet Neurocinematics Database (INcDb), which is a database of functional magnetic resource imaging (fMRI) data collected while people watch full length movies.
">

  <link rel="stylesheet" href="/2015/group35/css/main.css">
  <link rel="canonical" href="http://students.cs.ucl.ac.uk/2015/group35/2015/group35/docs/">
  <link rel="alternate" type="application/rss+xml" title="Internet Neurocinematics Database" href="http://students.cs.ucl.ac.uk/2015/group35/2015/group35/feed.xml">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/2015/group35/">Group 35</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/2015/group35/background/">Background</a>
          
        
          
          <a class="page-link" href="/2015/group35/design/">Design</a>
          
        
          
          <a class="page-link" href="/2015/group35/docs/">Docs</a>
          
        
          
        
          
        
          
        
          
          <a class="page-link" href="/2015/group35/project/">Project</a>
          
        
          
          <a class="page-link" href="/2015/group35/requirements/">Requirements</a>
          
        
          
          <a class="page-link" href="/2015/group35/research/">Research</a>
          
        
          
          <a class="page-link" href="/2015/group35/support/">Support</a>
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <style>
table{
    border-collapse: collapse;
    border-spacing: 0;
    border:1px solid #ddd;
    margin: 16px 0;
    width: 100%;
}

th{
    text-align: left;
}

td, th{
    border:1px solid #ddd;
    padding: 8px;
    font-size: 14px;
}
img {
    border:1px solid #ddd;
}
</style>

<article class="post">

  <header class="post-header">
    <h1 class="post-title">Docs</h1>
  </header>

  <div class="post-content">
    <p>TODO</p>

<ol>
  <li>Development plan, iterations and forks in prototypes</li>
  <li>Technical achievements, implementation details, use of design patterns</li>
</ol>

<h2 id="technical-achievements">Technical Achievements</h2>

<h2 id="implementation-details-todo">Implementation Details (TODO)</h2>

<h2 id="design-patterns">Design Patterns</h2>

<h3 id="model-view-controller-mvc">Model View Controller (MVC)</h3>

<p>For INcDb, we implemented Model View Controller to separates the application logic from the user interface. The separation is done by using having the Controller to receive input and interacting with the Model and passing the data required to the View.</p>

<p>The <strong>Controllers</strong> are found in the path <code class="highlighter-rouge">app/controllers</code>. Each actions in the <code class="highlighter-rouge">controllers</code> are associated with a predefined route. The controller action uses the <strong>Models</strong> found in <code class="highlighter-rouge">app/models</code> to retrieve data from a database. The data is then passed to a <strong>View</strong>, located in the <code class="highlighter-rouge">app/templates/</code>. The view will then present the data to the user in their browser.</p>

<p>Example of a Controller action:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>@home_blueprint.route('guide')
def guide():
    return render_template('guide.html')
</code></pre>
</div>

<p>Example of a Model:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>class DecodingSet(db.Model):
  __tablename__ = 'decoding_set'

  id = db.Column(db.Integer, primary_key=True)
  analysis_set_id = db.Column(db.Integer,
                            db.ForeignKey(AnalysisSet.id), nullable=True)
  analysis_set = db.relationship(AnalysisSet,
                               backref=db.backref('decoding_set'))
  name = db.Column(db.String(20))
  n_images = db.Column(db.Integer)
  n_voxels = db.Column(db.Integer)
  is_subsampled = db.Column(db.Boolean)
</code></pre>
</div>

<h3 id="decorators">Decorators</h3>

<p>We used Decorator design pattern to add additional functionality to each view in Flask. A decorator is a function that returns a function. As each view in Flask is a function, we used the <code class="highlighter-rouge">route()</code> and <code class="highlighter-rouge">login_required()</code> decorators to implement routing and access control for the views.</p>

<blockquote>
  <p><code class="highlighter-rouge">route()</code> decorator</p>
</blockquote>

<p><code class="highlighter-rouge">route()</code> is a decorator by Flask that is used to register the a view function for a given URL rule. Using a decorator simplify the code as it apply the routing functionality to the view function that follows it. Although the <code class="highlighter-rouge">flask.add_url_rule()</code> work exactly the same, it requires the name of view function in its parameter. A change in the name of the view function will result in error in routing.</p>

<blockquote>
  <p><code class="highlighter-rouge">login_required()</code> decorator</p>
</blockquote>

<p>To allow only logged in user to create collection and upload Raw Dataset, we apply the <code class="highlighter-rouge">@login_required</code> decorator provided by Flask-Login to redirect user to the login in page if they are not logged in and try to access the page.</p>

<p>The following code snippets show how <code class="highlighter-rouge">route</code> and <code class="highlighter-rouge">login_required</code> decorators are implemented.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>@contribute_blueprint.route('contribute/new', methods=["POST", "GET"])
@login_required  # Limits access to authenticated users
def new_collection():
    """ Allow user to create new collection """

    ...
</code></pre>
</div>

<hr />

<h2 id="architectural-diagrams">Architectural Diagrams</h2>

<h3 id="deployment-diagram">Deployment Diagram</h3>
<object data="../images/diagrams/deployment.svg" width="100%" type="image/svg+xml">
</object>

<p>Database Schema
<img src="../images/diagrams/schema.svg" style="width:100%" /></p>

<hr />

<h2 id="referenced-materials">Referenced Materials</h2>

<p>Referenced materials cited and examples/trials made</p>

<ol>
  <li>
    <p>neurosynth-web - <a href="https://github.com/neurosynth/neurosynth-web">https://github.com/neurosynth/neurosynth-web</a></p>
  </li>
  <li>
    <p>Neurosynth Viewer - <a href="https://github.com/neurosynth/nsviewer">https://github.com/neurosynth/nsviewer</a></p>
  </li>
  <li>
    <p>Flask-User starter app - <a href="https://github.com/lingthio/Flask-User-starter-app">https://github.com/lingthio/Flask-User-starter-app</a></p>
  </li>
  <li>
    <p>Helper to list routes (like Rails’ rake routes) - <a href="http://flask.pocoo.org/snippets/117/">http://flask.pocoo.org/snippets/117/</a></p>
  </li>
  <li>
    <p>How to paginate in Flask-SQLAlchemy for db.session joined queries? - <a href="http://stackoverflow.com/questions/15727155/how-to-paginate-in-flask-sqlalchemy-for-db-session-joined-queries">http://stackoverflow.com/questions/15727155/how-to-paginate-in-flask-sqlalchemy-for-db-session-joined-queries</a></p>
  </li>
  <li>
    <p>Error Handlers - <a href="http://flask.pocoo.org/docs/0.10/patterns/errorpages/#error-handlers">http://flask.pocoo.org/docs/0.10/patterns/errorpages/#error-handlers</a></p>
  </li>
  <li>
    <p>Flask AJAX Autocomplete - <a href="http://stackoverflow.com/questions/15310644/flask-ajax-autocomplete">http://stackoverflow.com/questions/15310644/flask-ajax-autocomplete</a></p>
  </li>
  <li>
    <p>flask-multi-upload - <a href="https://github.com/kirsle/flask-multi-upload">https://github.com/kirsle/flask-multi-upload</a></p>
  </li>
  <li>
    <p>How to unzip file in Python on all OSes? - <a href="http://stackoverflow.com/questions/12886768/how-to-unzip-file-in-python-on-all-oses">http://stackoverflow.com/questions/12886768/how-to-unzip-file-in-python-on-all-oses</a></p>
  </li>
  <li>
    <p>Setting up Celery Task Queue- <a href="http://docs.celeryproject.org/en/latest/index.html">http://docs.celeryproject.org/en/latest/index.html</a></p>
  </li>
  <li>
    <p>Running Celery Worker Daemonized using Supervisor - <a href="https://github.com/celery/celery/blob/3.1/extra/supervisord/celeryd.conf">https://github.com/celery/celery/blob/3.1/extra/supervisord/celeryd.conf</a></p>
  </li>
  <li>
    <p>!!! NSViewer</p>
  </li>
</ol>

<h3 id="trials-made">Trials Made</h3>

<hr />

<h2 id="testing-and-evaluation">Testing and Evaluation</h2>

<h3 id="unit-tesing-using-pytest">Unit Tesing using pytest</h3>

<p>We tested INcDb on 2 different kind of test cases.</p>

<ol>
  <li>
    <p>The first kind is using the client which act like the browser, to navigate INcDb. We check that given each URL, the expected layout is return by confirming the content of the layout contain the keywords (usually the title of the page) we specified.</p>
  </li>
  <li>
    <p>We also tested the Python functions like <code class="highlighter-rouge">find_or_create_user</code> to verify that data is added correctly into the database.</p>
  </li>
</ol>

<p>The set of test cases can be found at <a href="https://github.com/UCL-CS35/incdb-poc/tree/master/tests">https://github.com/UCL-CS35/incdb-poc/tree/master/tests</a></p>

<h3 id="issues-faced">Issues Faced</h3>

<p>As we try to keep each set of test cases independent, we intialise the database for every set of test cases. However, the initialisation of Neurosynth dataset take up a considerable amount of time (at least 5 minutes). Thus, we did not implement detailed and complicated test cases.</p>

<hr />

<h2 id="system-manual">System Manual</h2>

<h3 id="system-requirements">System Requirements</h3>

<ul>
  <li>
    <p>Operating System: Mac OS X 10.7+, Ubuntu 14.04.4 x64 (Tested)</p>
  </li>
  <li>
    <p>Memory: 5GB+ (excluding memory space required for Raw and Processed Dataset)</p>
  </li>
  <li>
    <p>Browser: Chrome 45+, Safari 9+, Firefox 42+, Edge 25+, IE 11+ (JavaScript Enabled)</p>
  </li>
  <li>
    <p>Python and pip Installed</p>
  </li>
</ul>

<h3 id="deploying-incdb">Deploying INcDb</h3>

<p>Install Virtual Environment using pip:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>pip install virtualenv
</code></pre>
</div>

<p>Cloning the app into a folder named “incdb-poc”</p>

<div class="highlighter-rouge"><pre class="highlight"><code>git clone https://github.com/UCL-CS35/incdb-poc.git incdb-poc
</code></pre>
</div>

<p>Create the “incdb” virtual environment</p>

<div class="highlighter-rouge"><pre class="highlight"><code>mkvirtualenv incdb
</code></pre>
</div>

<p>Install required Python packages</p>

<div class="highlighter-rouge"><pre class="highlight"><code>cd /path/to/incdb-poc
workon incdb
pip install -r requirements.txt
</code></pre>
</div>

<h3 id="setting-up-incdb">Setting Up INcDb</h3>

<p>Run Celery Work</p>

<div class="highlighter-rouge"><pre class="highlight"><code>celery worker -A app.initializers.mycelery -l info
</code></pre>
</div>

<p>Run Redis Server</p>

<div class="highlighter-rouge"><pre class="highlight"><code>redis-server
</code></pre>
</div>

<p>To install redis-server from source on Ubuntu, follow the tutorial by Digital Ocean, <a href="https://www.digitalocean.com/community/tutorials/how-to-install-and-use-redis/">https://www.digitalocean.com/community/tutorials/how-to-install-and-use-redis/</a></p>

<p>Initialising the Database</p>

<div class="highlighter-rouge"><pre class="highlight"><code># Setup Neruoysnth Dataset
# Create DB tables and populate with Terms from Neurosynth
# Populate the roles and users tables	
python manage.py init_db
</code></pre>
</div>

<h3 id="running-the-app">Running the App</h3>

<div class="highlighter-rouge"><pre class="highlight"><code># Start the Flask development web server
./runserver.sh    # will run "python manage.py runserver"
</code></pre>
</div>

<p>Point your web browser to http://http://127.0.0.1:5000/</p>

<p>You can make use of the following users:</p>

<ul>
  <li>email <code class="highlighter-rouge">jeremy@incdb.com</code> with password <code class="highlighter-rouge">Password1</code> with Administrative Privileges.</li>
  <li>email <code class="highlighter-rouge">ong@incdb.com</code> with password <code class="highlighter-rouge">Password1</code>.</li>
  <li>email <code class="highlighter-rouge">johnson@incdb.com</code> with password <code class="highlighter-rouge">Password1</code>.</li>
  <li>email <code class="highlighter-rouge">rajind@incdb.com</code> with password <code class="highlighter-rouge">Password1</code>.</li>
</ul>

<h3 id="testing-the-app">Testing the app</h3>

<div class="highlighter-rouge"><pre class="highlight"><code># Run all the automated tests in the tests/ directory
./runtests.sh         # will run "py.test -s tests/"
</code></pre>
</div>

<h3 id="known-issues">Known Issues</h3>

<blockquote>
  <p>Out of Memory during Installation of Python Packages</p>
</blockquote>

<p>As <code class="highlighter-rouge">matplotlib</code> and <code class="highlighter-rouge">nilearn</code> both require a large memory space during installation, the remote server might run out of memory. One way to overcome this issue is to add Swap on the server. Swap is created from the hard drive space and used by the operating system to store data for a non-permanent basis when it run out memory in the RAM to hold the data.</p>

<p>If you face the Out of Memory issue, follow the tutorial by Digital Ocean to add Swap to your remote server. <a href="https://www.digitalocean.com/community/tutorials/how-to-add-swap-on-ubuntu-14-04">https://www.digitalocean.com/community/tutorials/how-to-add-swap-on-ubuntu-14-04</a></p>

<blockquote>
  <p>Trouble installing SciPy and NumPy</p>
</blockquote>

<p>Try installing the dependencies of <code class="highlighter-rouge">python-scipy</code> and <code class="highlighter-rouge">python-numpy</code> using the following command:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo apt-get build-dep python-numpy python-scipy
</code></pre>
</div>

<h3 id="troubleshooting">Troubleshooting</h3>

<ul>
  <li>
    <p>If you make changes in the Models and run into DB schema issues, delete the sqlite DB file <code class="highlighter-rouge">app.sqlite</code>.</p>
  </li>
  <li>
    <p>If you have any other troubles with setting up INcDb, tell us on the <a href="../support/">Discussion Forum</a>.</p>
  </li>
</ul>

<hr />

<h2 id="user-guide-v01">User Guide v0.1</h2>

<h3 id="repository-browsing">Repository Browsing</h3>

<blockquote>
  <p>Select a Movie</p>
</blockquote>

<p>From the Home page or the Movies index page, you can select a Movie by looking through the list of recently added Movies to the website. Once you select a Movie, you can browse through the different Terms and Components (brain images) available for the selected Movie.</p>

<blockquote>
  <p>Search for a Movie</p>
</blockquote>

<p>From the home page or the Movies index page, you can search for a specific Movie by using the search bar. An auto-suggestion box will assist your search with relevant Movie suggested based on your input. Once you select a Movie, you can browse through the different Terms and Components (brain images) available for the selected Movie.</p>

<blockquote>
  <p>Select a Term</p>
</blockquote>

<p>From the Terms index page, you can select a Term by looking through the list of Term that has at least one Component that is highly-coreleated with. Once you select a Term, you can browse throught the different Components corelated with the selected Term.</p>

<blockquote>
  <p>Search for a Term</p>
</blockquote>

<p>From the Terms index page, you can search for a specific Term by using the search bar. Once you select a Term, you can browse throught the different Components corelated with the selected Term.</p>

<blockquote>
  <p>View Brain Component</p>
</blockquote>

<p>From the selected Movie or Term page, you can select a Component to futher investigate the brain images. For each Component, the Neurosynth’s Brain Viewer display 3 brain images (the x-axis, y-axis and z-axis). You can click around different points on the brain image or use the sliders below each image to adjust the coordinates.</p>

<p>Below the set of brain images consists the layers displayed. These usually comprise of the brain overlay as a template and the remaining layers relevant to the different regions. When browsing through brain imagery for different Terms, you might notice layers that comprise of “forward” and “backward” analysis. What exactly are they? To simply put -</p>

<ul>
  <li>
    <p>Forward Analysis - z-scores corresponding to the likelihood that a region will activate if a Movie uses a particular Term</p>
  </li>
  <li>
    <p>Backward Analysis - z-scores corresponding to the likelihood that a Term is used in a Movie given the presence of reported activation</p>
  </li>
</ul>

<h3 id="data-submission">Data Submission</h3>

<p><strong>Only signed-in user can submit dataset</strong></p>

<blockquote>
  <p>Create Collection</p>
</blockquote>

<p>You can create a Collection by filling up the information of the Collection. The Collection Name and Movie Name are required for the creation of the Collection. You can fill in the non-mandatory fields later.</p>

<blockquote>
  <p>Upload Raw Dataset</p>
</blockquote>

<p>After creating the Collection, you will be redirected to the Upload page. You can upload your raw dataset in one or multiple compressed files. The accepted file formats are zip and tar.gz. The compressed file must contain the brain images in the immediate child directory. A progress bar will indicate the uploading progress. A warning dialog will be displayed if you attempt to navigate away from the upload page during the uploading process. As the size of the files are big, please wait patiently for the files to be uploaded.</p>

<blockquote>
  <p>Edit Collection</p>
</blockquote>

<p>You can edit the Collection’s details on the Collection page. The Collection Name is an unique indentifier for the Collection so it cannot be edited.</p>

<blockquote>
  <p>Delete Collection</p>
</blockquote>

<p>You can delete the Collection and the Raw Dataset that you uploaded will be removed from the INcDb’s server. If the Processed Dataset is uploaded for the deleted Collection, the Processed Dataset will also be removed.</p>

<h3 id="user-management">User Management</h3>

<blockquote>
  <p>Register Account</p>
</blockquote>

<p>You can register an account by entering your Email, Title, First and Last Name. You are required to set your password for your account and retype the same password for confirmation. After successful registration, you can sign in to INcDb with your email and password.</p>

<blockquote>
  <p>Sign In and Sign Out</p>
</blockquote>

<p>If you already has a registered account, you can sign in to INcDb with your email and password. To sign out from INcDb, click on your name on the navigation bar and click on the Sign Out link.</p>

<blockquote>
  <p>Edit User Account</p>
</blockquote>

<p>If you are signed in to INcDb, you can edit your account’s details such as your Title, First and Last Name, and Affiliation. To update your account with the changes you made, you must click on the Save button. You can also change your password.</p>

<h3 id="administrative-privileges">Administrative Privileges</h3>

<blockquote>
  <p>Download user uploaded Raw Dataset</p>
</blockquote>

<p>As administrator of INcDb, you can download the Raw Dataset of a Collection, uploaded by the other users. You will download a compressed file containing all the brain images of the Collection you had chosen. As the the size of the brain images are large, please wait patiently for the download to be completed.</p>

<blockquote>
  <p>Upload Processed Dataset</p>
</blockquote>

<p>As administrator of INcDb, you can upload the Processed Dataset of a Collection that is created by other users. When the upload is completed, a background thread will decode the brain images and compute their corelations with the Terms in the database. The database will be populated with the Components (brain images) and the corelations will be stored in a text file on the server.</p>


    
  </div>

</article>

      </div>


      
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">

      <div class="footer-col">
        <ul class="contact-list">
          
          <li>Internet Neurocinematics Database. Systems Engineering Project Group 35.</li>
          <li>© 2015-2016 Johnson Cheung, Yong Lin Ong, Rajind Karunaratne.</li>
        </ul>
      </div>

    </div>

  </div>

</footer>


  </body>

</html>
