<!DOCTYPE html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="keywords" content=" ">
<title>Technical Achievements  | Project Website for UCL Systems Engineering Project - Group 35</title>
<link rel="stylesheet" href="/2015/group35/css/syntax.css">


<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="/2015/group35/css/modern-business.css">
<link rel="stylesheet" href="/2015/group35/css/lavish-bootstrap.css">
<link rel="stylesheet" href="/2015/group35/css/customstyles.css">
<link rel="stylesheet" href="/2015/group35/css/theme-blue.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="/2015/group35/js/jquery.navgoco.min.js"></script>


<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="/2015/group35/js/toc.js"></script>
<script src="/2015/group35/js/customscripts.js"></script>

<link rel="shortcut icon" href="/2015/group35/images/favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="" href="http://students.cs.ucl.ac.uk//2015/group35/feed.xml">




 
    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    
</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-home fa-lg navbar-brand" href="/2015/group35/">&nbsp;<span class="projectTitle"> Group 35</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- entries without drop-downs appear here -->
                
                
                
                <li><a href="http://188.166.170.92/" target="_blank">Live Demo</a></li>
                
                
                
                <li><a href="https://github.com/UCL-CS35" target="_blank">GitHub</a></li>
                
                
                
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                
                
			<!-- Send feedback function -->
<script>
function SendLinkByMail(href) {
var subject= "Project Website for UCL Systems Engineering Project - Group 35 feedback";
var body = "I have some feedback about the Technical Achievements page: ";
body += window.location.href;
body += "";
var uri = "mailto:zcabjcy@ucl.ac.uk?subject=";
uri += encodeURIComponent(subject);
uri += "&body=";
uri += encodeURIComponent(body);
window.location.href = uri;
}
</script>

<li><a href="javascript:(function()%7BSendLinkByMail()%3B%7D)()%3B" target="_blank"><i class="fa fa-envelope-o"></i> Feedback</a></li>

		
                <!--comment out this block if you want to hide search-->
                <li>
                    <!--start search-->
                    <div id="search-demo-container">
                        <input type="text" id="search-input" placeholder="search...">
                        <ul id="results-container"></ul>
                    </div>
                    <script src="/2015/group35/js/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                            SimpleJekyllSearch.init({
                                searchInput: document.getElementById('search-input'),
                                resultsContainer: document.getElementById('results-container'),
                                dataSource: '/2015/group35/search.json',
                                searchResultTemplate: '<li><a href="{url}" title="Technical Achievements">{title}</a></li>',
                    noResultsText: 'No results found.',
                            limit: 10,
                            fuzzy: true,
                    })
                    </script>
                    <!--end search-->
                </li>
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>
<!-- Page Content -->
<div class="container">
    <div class="col-lg-12">&nbsp;</div>
    <!-- Content Row -->
    <div class="row">
        <!-- Sidebar Column -->
        <div class="col-md-3">

          








<ul id="mysidebar" class="nav">
    <li class="sidebarTitle">Group 35 - INcDb </li>
    
    
    
    <li>
        <a href="#">Overview</a>
        <ul>
            
            
            
            <li><a href="/2015/group35/">Project Home</a></li>
            
            
            
            
            
            
            <li><a href="/2015/group35/background/">Background</a></li>
            
            
            
            
            
            
            <li><a href="/2015/group35/requirements/">Requirements</a></li>
            
            
            
            
            
            
            <li><a href="/2015/group35/use-cases/">Use Cases</a></li>
            
            
            
            
            
            
            <li><a href="/2015/group35/evaluation/">Evaluation</a></li>
            
            
            
            
            
            
            <li><a href="/2015/group35/glossary/">Glossary</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Project Management</a>
        <ul>
            
            
            
            <li><a href="/2015/group35/project/progress/">Progress</a></li>
            
            
            
            
            
            
            <li><a href="/2015/group35/project/biweekly/">Bi-Weekly Reports</a></li>
            
            
            
            
            
            
            <li><a href="/2015/group35/project/repositories/">Repositories</a></li>
            
            
            
            
            
            
            <li><a href="/2015/group35/project/tools/">Tools</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Research</a>
        <ul>
            
            
            
            <li><a href="/2015/group35/research/neurosynth-neurovault/">Neurosynth & Neurovault</a></li>
            
            
            
            
            
            
            <li><a href="/2015/group35/research/version-control/">Version Control - Git & GitHub</a></li>
            
            
            
            
            
            
            <li><a href="/2015/group35/research/flask/">Flask</a></li>
            
            
            
            
            
            
            <li><a href="/2015/group35/research/bootstrap/">Frontend - Bootsrap</a></li>
            
            
            
            
            
            
            <li><a href="/2015/group35/research/deployment/">Deployment</a></li>
            
            
            
            
            
            
            <li><a href="/2015/group35/research/prototype/">Initial Prototype</a></li>
            
            
            
            
            
            
            <li><a href="/2015/group35/research/testing-strategy/">Testing Strategy</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Design</a>
        <ul>
            
            
            
            <li><a href="/2015/group35/design/sketches/">Stage 1 - Sketches</a></li>
            
            
            
            
            
            
            <li><a href="/2015/group35/design/wireframe/">Stage 2 - Wireframe</a></li>
            
            
            
            
            
            
            <li><a href="/2015/group35/design/mockups/">Stage 3 - Photoshop Mockups</a></li>
            
            
            
            
            
            
            <li><a href="/2015/group35/design/prototype/">Stage 4 - Prototyping</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Development</a>
        <ul>
            
            
            
            <li><a href="/2015/group35/development/plan/">Development Plan</a></li>
            
            
            
            
            
            
            <li class="active"><a href="/2015/group35/development/technical-acheivements/">Technical Achievements</a></li>
            
            
            
            
            
            
            <li><a href="/2015/group35/development/design-patterns/">Design Patterns</a></li>
            
            
            
            
            
            
            <li><a href="/2015/group35/development/architectural-diagrams/">Architectural Diagrams</a></li>
            
            
            
            
            
            
            <li><a href="/2015/group35/development/trials/">Trials</a></li>
            
            
            
            
            
            
            <li><a href="/2015/group35/development/references/">References</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Testing</a>
        <ul>
            
            
            
            <li><a href="/2015/group35/testing/">Testing</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Manuals</a>
        <ul>
            
            
            
            <li><a href="/2015/group35/manuals/system/">System Manual</a></li>
            
            
            
            
            
            
            <li><a href="/2015/group35/manuals/system-demo/">System Manual (Demo)</a></li>
            
            
            
            
            
            
            <li><a href="/2015/group35/manuals/user/">User Guide</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Support</a>
        <ul>
            
            
            
            <li><a href="/2015/group35/support/">Support</a></li>
            
            
            
            
        </ul>
        
        
        
        <!-- if you aren't using the accordion, uncomment this block:
           <p class="external">
               <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
           </p>
           -->
    </li>
</ul>
</div>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>
    <!-- Content Column -->
    <div class="col-md-9">
        <div class="post-header">
   <h1 class="post-title-main">Technical Achievements</h1>
</div>

<div class="post-content">

   

    
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2,h3,h4' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})
  
});
</script>

<div id="toc"></div>

    

    

  <h2 id="implementation-details">Implementation Details</h2>

<h3 id="neurosynth-dataset-generation">1. Neurosynth Dataset generation.</h3>

<p>INcDb requires a Neurosynth dataset that it uses to generate Term Analyses. The generation of Neurosynth Dataset is a memory-intensive operation which is not suitable to be done on a remote server, which typically has less RAM.</p>

<p>We suggest the Dataset to be generated on a local machine. Follow the instructions on <a href="https://github.com/neurosynth/neurosynth">https://github.com/neurosynth/neurosynth</a> to build your own Dataset (<code class="highlighter-rouge">neurosynth_dataset.pkl</code>) and copy the Dataset to <code class="highlighter-rouge">incdb-poc/app/data/assets/</code>.</p>

<p>With the Dataset in place, we can initialise the database and add the Analyses to the database. These analyses will then be used to compute the correlation of the Components with the Terms.</p>

<h3 id="flask-application">2. Flask Application</h3>

<p>The main function of the INcDb is the repository browsing. This is implemented using database query and Flask routing mechanism. Flask routing function help to pass variable name through the URL and this variable is used to select the necessary data from the database to be displayed.</p>

<p>The user management was implemented using the Flask extension - Flask-User. The user management allow signed in users to create Collection and upload Raw Dataset.</p>

<p>Flask-WTF, a Flask extension, was used to simplify the creation of the complicated Collection’s form.</p>

<h3 id="computation-of-correlation-between-component-and-terms">3. Computation of correlation between Component and Terms</h3>

<p>Another key function performed by the INcDb is to compute the correlations of the Components uploaded by our client with the Terms Analyses generated by the Neurosynth Dataset generation. As requested by our client, we referenced the computation done by the open-sourced Neurosynth-Web, <a href="https://github.com/neurosynth/neurosynth-web/blob/master/nsweb/tasks/__init__.py">https://github.com/neurosynth/neurosynth-web/blob/master/nsweb/tasks/__init__.py</a>, and implemented a similar decoding function for INcDb.</p>

<p>The decoding is done when new Processed Dataset is uploaded to the server by our client and the top 10 Terms (with the highest correlations) for each Component are stored in a text files on the remote server. These text files are retrieved to display the correlation values when user view the Component.</p>

<p>For each Component of the Processed Dataset, a row in the Decodings table (in the database) is also created and tagged with the Term that it has the higest correlation with.</p>

<h3 id="neurosynth-viewer">4. Neurosynth Viewer</h3>

<p>The main aspect of the web application is to provide a way to view different brain images. This was done using the Neurosynth Viewer framework to view and interact with brain imaging data on a web page, as well as Nipype + AFNI to prepare the imaging data for Terms for a specific Movie.</p>

<p>The Neurosynth Viewer is implemented within the HTML code as part of a Javascript block. Since this is a Python Flask application, macro fields are added as a placeholder for the location of the brain imaging data to help load the relevant images for dynamically generated web pages. These macro fields run Python functions written earlier that, when given the name of a Component or Movie, it will search within the directories in the server and send the files as an attachment to the Viewer.</p>

<p>Part of the functionality is assisted by the AFNI toolset, which makes it possible to merge multiple brain images into one image. This is useful for deriving a brain image for an individual Term for a specific Movie. The selection of these brain images is done by querying through the list if Components, and identifying the Components for the specific Movie and Term. This is saved in an array and fed to the AFNI toolset to merge.</p>

<p>This merging process is done after the decoding process upon upload by the admin. The Nipype Python package serves as an interface to provide Python functions to easily interact with the AFNI toolset.</p>

<h3 id="background-task-using-celery-and-redis">5. Background task using Celery and Redis</h3>

<p>To improve the user experience and efficiency, we have decided to make the decoding funciton a background task. By running the decoding asynchronously, the user (Dr. Skipper) will be able to turn to other pages of INcDb and continue with other tasks, or assign more decoding tasks for INcDb to work on, instead of having to wait on the page while the long-running task is being completed.</p>

<p>For implementing background tasks, the Celery task queue and Redis message broker are used. First of all, a Celery Worker as well as the Redis Server must be running (which we have set to start automatically with the server). A task is set to be run asynchronously by setting the method as a Celery Task in Flask, and calling it with a delay() decoration, which then a message is sent to the Redis server, translated and forwarded to the Celery Worker, and pushing that task onto the task queue.</p>

<p>Then the tasks in the task queue are completed in order by the Celery Worker.</p>

<h2 id="dependencies">Dependencies</h2>

<p>The application is developed with a list of dependecies. The complete list of Python packages dependencies can be found at <a href="https://github.com/UCL-CS35/incdb-poc/blob/master/requirements.txt">https://github.com/UCL-CS35/incdb-poc/blob/master/requirements.txt</a>.</p>

<p>We will like to highlight a few key dependencies that were critical for the development of INcDb.</p>

<table>
	<thead>
		<tr>
			<th>Name</th>
			<th>Role</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td width="15%">Flask</td>
			<td>The micro-framework that INcDb runs on.</td>
		</tr>
		<tr>
			<td>Flask-User</td>
			<td>Flask extension used to implement User Management feature.</td>
		</tr>
		<tr>
			<td>Flask-WTF</td>
			<td>Flask extension used to simply form creation.</td>
		</tr>
		<tr>
			<td>Neurosynth</td>
			<td>Neurosynth is used to generate analyses that is used for the decoding of the Processed Dataset uploaded by our client.</td>
		</tr>
		<tr>
			<td>gunicorn</td>
			<td>A Python WSGI HTTP Server to serve the Flask application.</td>
		</tr>
		<tr>
			<td>celery</td>
			<td>A task processing system used to manage background tasks like decoding.</td>
		</tr>
		<tr>
			<td>Redis</td>
			<td>Redis is used as message broker to pass messages between Flask application and Celery workers.</td>
		</tr>
	</tbody>
</table>

<h2 id="code-structure">Code Structure</h2>

<p>The application first-level code structure is presented below and the role of each file or folder is explained.</p>

<ul>
  <li>incdb-poc/
    <ul>
      <li>app/
        <ul>
          <li>Contains Models, Views (templates), Controllers, Static files (CSS, JS, Images, Fonts), Setup scripts</li>
        </ul>
      </li>
      <li>data/
        <ul>
          <li>Contains Neurosynth Dataset, Decoding results, Admin uploaded Processed Dataset, Generated memmaps, FAQ data</li>
        </ul>
      </li>
      <li>default/</li>
      <li>docs/
        <ul>
          <li>Documentations generated by Sphinx</li>
        </ul>
      </li>
      <li>migrations/
  		* Migrations genereted (Currently empty)</li>
      <li>node_modules/
        <ul>
          <li>Node modules required to run Neurosynth Viewer</li>
        </ul>
      </li>
      <li>src/
        <ul>
          <li>Coffeescript requred to run Neurosnyth Viewer</li>
        </ul>
      </li>
      <li>tests/
        <ul>
          <li>pytests written to test User Managemnent, Search, Creation of Collection</li>
        </ul>
      </li>
      <li>uploads/
        <ul>
          <li>Contains User uploaded Raw Dataset</li>
        </ul>
      </li>
      <li>.gitignore
        <ul>
          <li>Ignore Database and Data folders</li>
        </ul>
      </li>
      <li>Aptfile</li>
      <li>Cakefile</li>
      <li>Guardfile</li>
      <li>LICENSE.txt</li>
      <li>manage.py
        <ul>
          <li>Use to start the Flask application</li>
        </ul>
      </li>
      <li>README.md</li>
      <li>requirements.txt
        <ul>
          <li>List of Python packages required</li>
        </ul>
      </li>
      <li>runserver.sh
        <ul>
          <li>Bash script to run the the Flask application in development mode</li>
        </ul>
      </li>
      <li>runtests.sh
        <ul>
          <li>Bash script to run the Test Cases in /tests folder</li>
        </ul>
      </li>
      <li>supervsiord.conf
        <ul>
          <li>Supervisor configuration file used for Deployment</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p>For the complete code, you can view them on <a href="https://github.com/UCL-CS35/incdb-poc">GitHub</a>.</p>


<div class="tags">
    
</div>

    

</div>

<hr class="shaded"/>

<footer>
            <div class="row">
                <div class="col-lg-12 footer">
               &copy;2016 UCL Systems Engineering Project - Group 35.. All rights reserved. <br />
 Site last generated: Apr 25, 2016
                </div>
            </div>
</footer>
    </div>
    <!-- /.row -->
</div>
<!-- /.container -->
    </div>
</body>

</html>